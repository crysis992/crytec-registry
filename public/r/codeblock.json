{
  "$schema": "https://ui.shadcn.com/schema/registry-item.json",
  "name": "codeblock",
  "title": "CodeBlock",
  "description": "A compound code block component with syntax highlighting, multi-file tabs, copy button, and customizable themes.",
  "dependencies": ["shiki", "lucide-react"],
  "registryDependencies": ["utils"],
  "files": [
    {
      "path": "registry/new-york/ui/custom/codeblock.tsx",
      "content": "\"use client\"\n\nimport * as React from \"react\"\nimport { Check, ChevronDown, Copy } from \"lucide-react\"\nimport { codeToHtml, type BundledLanguage, type BundledTheme } from \"shiki\"\n\nimport { cn } from \"@/lib/utils\"\n\n/* -----------------------------------------------------------------------------\n * Types\n * -------------------------------------------------------------------------- */\n\ninterface CodeBlockData {\n  value: string\n  filename?: string\n  code: string\n  language?: string\n}\n\ninterface CodeBlockTheme {\n  light: BundledTheme\n  dark: BundledTheme\n}\n\ninterface CodeBlockContextValue {\n  items: CodeBlockData[]\n  activeValue: string\n  setActiveValue: (value: string) => void\n  highlightedCode: Map<string, string>\n  isLoading: boolean\n  showLineNumbers: boolean\n  theme: CodeBlockTheme\n  copyCode: () => Promise<void>\n  hasCopied: boolean\n}\n\n/* -----------------------------------------------------------------------------\n * Context\n * -------------------------------------------------------------------------- */\n\nconst CodeBlockContext = React.createContext<CodeBlockContextValue | null>(null)\n\nfunction useCodeBlock() {\n  const context = React.useContext(CodeBlockContext)\n  if (!context) {\n    throw new Error(\"useCodeBlock must be used within a CodeBlock\")\n  }\n  return context\n}\n\n/* -----------------------------------------------------------------------------\n * CodeBlock (Root)\n * -------------------------------------------------------------------------- */\n\ninterface CodeBlockProps {\n  data: CodeBlockData[]\n  defaultValue?: string\n  children: React.ReactNode\n  className?: string\n  showLineNumbers?: boolean\n  theme?: CodeBlockTheme\n}\n\nfunction CodeBlock({\n  data,\n  defaultValue,\n  children,\n  className,\n  showLineNumbers = false,\n  theme = { light: \"github-light\", dark: \"github-dark\" },\n}: CodeBlockProps) {\n  const [activeValue, setActiveValue] = React.useState(\n    defaultValue ?? data[0]?.value ?? \"\"\n  )\n  const [highlightedCode, setHighlightedCode] = React.useState<Map<string, string>>(\n    new Map()\n  )\n  const [isLoading, setIsLoading] = React.useState(true)\n  const [hasCopied, setHasCopied] = React.useState(false)\n\n  // Stable dependency key for data array to prevent infinite re-renders\n  const dataKey = React.useMemo(\n    () => JSON.stringify(data.map((d) => ({ v: d.value, c: d.code, l: d.language }))),\n    [data]\n  )\n  const themeKey = `${theme.light}-${theme.dark}`\n\n  React.useEffect(() => {\n    let cancelled = false\n\n    async function highlightAll() {\n      setIsLoading(true)\n      const results = new Map<string, string>()\n\n      for (const item of data) {\n        if (cancelled) return\n\n        try {\n          const html = await codeToHtml(item.code.trim(), {\n            lang: (item.language ?? item.value) as BundledLanguage,\n            themes: {\n              light: theme.light,\n              dark: theme.dark,\n            },\n          })\n          results.set(item.value, html)\n        } catch {\n          // Fallback to plaintext if language not supported\n          const html = await codeToHtml(item.code.trim(), {\n            lang: \"plaintext\",\n            themes: {\n              light: theme.light,\n              dark: theme.dark,\n            },\n          })\n          results.set(item.value, html)\n        }\n      }\n\n      if (!cancelled) {\n        setHighlightedCode(results)\n        setIsLoading(false)\n      }\n    }\n\n    highlightAll()\n\n    return () => {\n      cancelled = true\n    }\n  // eslint-disable-next-line react-hooks/exhaustive-deps\n  }, [dataKey, themeKey])\n\n  React.useEffect(() => {\n    if (hasCopied) {\n      const timeout = setTimeout(() => setHasCopied(false), 2000)\n      return () => clearTimeout(timeout)\n    }\n  }, [hasCopied])\n\n  const copyCode = React.useCallback(async () => {\n    const activeItem = data.find((item) => item.value === activeValue)\n    if (activeItem) {\n      await navigator.clipboard.writeText(activeItem.code.trim())\n      setHasCopied(true)\n    }\n  }, [data, activeValue])\n\n  const contextValue = React.useMemo(\n    () => ({\n      items: data,\n      activeValue,\n      setActiveValue,\n      highlightedCode,\n      isLoading,\n      showLineNumbers,\n      theme,\n      copyCode,\n      hasCopied,\n    }),\n    [\n      data,\n      activeValue,\n      highlightedCode,\n      isLoading,\n      showLineNumbers,\n      theme,\n      copyCode,\n      hasCopied,\n    ]\n  )\n\n  return (\n    <CodeBlockContext.Provider value={contextValue}>\n      <div\n        data-slot=\"codeblock\"\n        className={cn(\n          \"rounded-lg border bg-[var(--muted)] overflow-hidden\",\n          className\n        )}\n      >\n        {children}\n      </div>\n    </CodeBlockContext.Provider>\n  )\n}\n\n/* -----------------------------------------------------------------------------\n * CodeBlockHeader\n * -------------------------------------------------------------------------- */\n\ninterface CodeBlockHeaderProps extends React.ComponentProps<\"div\"> {}\n\nfunction CodeBlockHeader({ className, children, ...props }: CodeBlockHeaderProps) {\n  return (\n    <div\n      data-slot=\"codeblock-header\"\n      className={cn(\n        \"flex items-center justify-between border-b px-4 py-2\",\n        className\n      )}\n      {...props}\n    >\n      {children}\n    </div>\n  )\n}\n\n/* -----------------------------------------------------------------------------\n * CodeBlockFiles\n * -------------------------------------------------------------------------- */\n\ninterface CodeBlockFilesProps {\n  children: (item: CodeBlockData) => React.ReactNode\n  className?: string\n}\n\nfunction CodeBlockFiles({ children, className }: CodeBlockFilesProps) {\n  const { items } = useCodeBlock()\n\n  return (\n    <div\n      data-slot=\"codeblock-files\"\n      className={cn(\"flex items-center gap-1\", className)}\n    >\n      {items.map((item) => children(item))}\n    </div>\n  )\n}\n\n/* -----------------------------------------------------------------------------\n * CodeBlockFilename\n * -------------------------------------------------------------------------- */\n\ninterface CodeBlockFilenameProps extends React.ComponentProps<\"button\"> {\n  value: string\n}\n\nfunction CodeBlockFilename({\n  value,\n  children,\n  className,\n  ...props\n}: CodeBlockFilenameProps) {\n  const { activeValue, setActiveValue } = useCodeBlock()\n  const isActive = activeValue === value\n\n  return (\n    <button\n      type=\"button\"\n      data-slot=\"codeblock-filename\"\n      data-active={isActive}\n      className={cn(\n        \"px-3 py-1 text-sm font-mono rounded-md transition-colors\",\n        isActive\n          ? \"bg-[var(--background)] text-[var(--foreground)]\"\n          : \"text-[var(--muted-foreground)] hover:text-[var(--foreground)]\",\n        className\n      )}\n      onClick={() => setActiveValue(value)}\n      {...props}\n    >\n      {children}\n    </button>\n  )\n}\n\n/* -----------------------------------------------------------------------------\n * CodeBlockSelect\n * -------------------------------------------------------------------------- */\n\nconst CodeBlockSelectContext = React.createContext<{\n  open: boolean\n  setOpen: React.Dispatch<React.SetStateAction<boolean>>\n} | null>(null)\n\ninterface CodeBlockSelectProps {\n  children: React.ReactNode\n}\n\nfunction CodeBlockSelect({ children }: CodeBlockSelectProps) {\n  const [open, setOpen] = React.useState(false)\n\n  return (\n    <CodeBlockSelectContext.Provider value={{ open, setOpen }}>\n      <div data-slot=\"codeblock-select\" className=\"relative\">\n        {children}\n      </div>\n    </CodeBlockSelectContext.Provider>\n  )\n}\n\n/* -----------------------------------------------------------------------------\n * CodeBlockSelectTrigger\n * -------------------------------------------------------------------------- */\n\ninterface CodeBlockSelectTriggerProps extends React.ComponentProps<\"button\"> {}\n\nfunction CodeBlockSelectTrigger({\n  className,\n  children,\n  ...props\n}: CodeBlockSelectTriggerProps) {\n  const selectContext = React.useContext(CodeBlockSelectContext)\n\n  return (\n    <button\n      type=\"button\"\n      data-slot=\"codeblock-select-trigger\"\n      className={cn(\n        \"flex items-center gap-2 px-3 py-1 text-sm font-mono rounded-md border bg-[var(--background)] transition-colors hover:bg-[var(--accent)]\",\n        className\n      )}\n      onClick={() => selectContext?.setOpen((prev) => !prev)}\n      {...props}\n    >\n      {children}\n      <ChevronDown className=\"h-4 w-4\" />\n    </button>\n  )\n}\n\n/* -----------------------------------------------------------------------------\n * CodeBlockSelectValue\n * -------------------------------------------------------------------------- */\n\ninterface CodeBlockSelectValueProps {\n  placeholder?: string\n}\n\nfunction CodeBlockSelectValue({ placeholder }: CodeBlockSelectValueProps) {\n  const { items, activeValue } = useCodeBlock()\n  const activeItem = items.find((item) => item.value === activeValue)\n\n  return (\n    <span data-slot=\"codeblock-select-value\">\n      {activeItem?.filename ?? activeItem?.value ?? placeholder ?? \"Select...\"}\n    </span>\n  )\n}\n\n/* -----------------------------------------------------------------------------\n * CodeBlockSelectContent\n * -------------------------------------------------------------------------- */\n\ninterface CodeBlockSelectContentProps {\n  children: (item: CodeBlockData) => React.ReactNode\n}\n\nfunction CodeBlockSelectContent({ children }: CodeBlockSelectContentProps) {\n  const selectContext = React.useContext(CodeBlockSelectContext)\n  const { items } = useCodeBlock()\n\n  if (!selectContext?.open) return null\n\n  return (\n    <div\n      data-slot=\"codeblock-select-content\"\n      className=\"absolute top-full left-0 mt-1 min-w-[150px] rounded-md border bg-[var(--background)] shadow-md z-50\"\n    >\n      {items.map((item) => children(item))}\n    </div>\n  )\n}\n\n/* -----------------------------------------------------------------------------\n * CodeBlockSelectItem\n * -------------------------------------------------------------------------- */\n\ninterface CodeBlockSelectItemProps extends React.ComponentProps<\"button\"> {\n  value: string\n}\n\nfunction CodeBlockSelectItem({\n  value,\n  children,\n  className,\n  ...props\n}: CodeBlockSelectItemProps) {\n  const { activeValue, setActiveValue } = useCodeBlock()\n  const selectContext = React.useContext(CodeBlockSelectContext)\n  const isActive = activeValue === value\n\n  return (\n    <button\n      type=\"button\"\n      data-slot=\"codeblock-select-item\"\n      data-active={isActive}\n      className={cn(\n        \"w-full px-3 py-2 text-sm text-left transition-colors hover:bg-[var(--accent)]\",\n        isActive && \"bg-[var(--accent)]\",\n        className\n      )}\n      onClick={() => {\n        setActiveValue(value)\n        selectContext?.setOpen(false)\n      }}\n      {...props}\n    >\n      {children}\n    </button>\n  )\n}\n\n/* -----------------------------------------------------------------------------\n * CodeBlockCopyButton\n * -------------------------------------------------------------------------- */\n\ninterface CodeBlockCopyButtonProps extends React.ComponentProps<\"button\"> {\n  onCopy?: () => void\n  onError?: (error: unknown) => void\n}\n\nfunction CodeBlockCopyButton({\n  onCopy,\n  onError,\n  className,\n  ...props\n}: CodeBlockCopyButtonProps) {\n  const { copyCode, hasCopied } = useCodeBlock()\n\n  const handleCopy = async () => {\n    try {\n      await copyCode()\n      onCopy?.()\n    } catch (error) {\n      onError?.(error)\n    }\n  }\n\n  return (\n    <button\n      type=\"button\"\n      data-slot=\"codeblock-copy\"\n      className={cn(\n        \"h-8 w-8 inline-flex items-center justify-center rounded-md border bg-[var(--background)] transition-all hover:bg-[var(--accent)] focus:outline-none\",\n        className\n      )}\n      onClick={handleCopy}\n      aria-label=\"Copy code\"\n      {...props}\n    >\n      {hasCopied ? (\n        <Check className=\"h-4 w-4 text-green-500\" />\n      ) : (\n        <Copy className=\"h-4 w-4\" />\n      )}\n    </button>\n  )\n}\n\n/* -----------------------------------------------------------------------------\n * CodeBlockBody\n * -------------------------------------------------------------------------- */\n\ninterface CodeBlockBodyProps {\n  children: (item: CodeBlockData) => React.ReactNode\n  className?: string\n}\n\nfunction CodeBlockBody({ children, className }: CodeBlockBodyProps) {\n  const { items } = useCodeBlock()\n\n  return (\n    <div data-slot=\"codeblock-body\" className={className}>\n      {items.map((item) => children(item))}\n    </div>\n  )\n}\n\n/* -----------------------------------------------------------------------------\n * CodeBlockItem\n * -------------------------------------------------------------------------- */\n\ninterface CodeBlockItemProps extends React.ComponentProps<\"div\"> {\n  value: string\n}\n\nfunction CodeBlockItem({\n  value,\n  children,\n  className,\n  ...props\n}: CodeBlockItemProps) {\n  const { activeValue } = useCodeBlock()\n\n  if (activeValue !== value) return null\n\n  return (\n    <div\n      data-slot=\"codeblock-item\"\n      className={cn(\"relative\", className)}\n      {...props}\n    >\n      {children}\n    </div>\n  )\n}\n\n/* -----------------------------------------------------------------------------\n * CodeBlockContent\n * -------------------------------------------------------------------------- */\n\ninterface CodeBlockContentProps extends React.ComponentProps<\"div\"> {\n  showLineNumbers?: boolean\n}\n\nfunction CodeBlockContent({\n  showLineNumbers: propShowLineNumbers,\n  className,\n  ...props\n}: CodeBlockContentProps) {\n  const {\n    highlightedCode,\n    isLoading,\n    showLineNumbers: contextShowLineNumbers,\n    activeValue,\n  } = useCodeBlock()\n\n  const showLines = propShowLineNumbers ?? contextShowLineNumbers\n  const html = highlightedCode.get(activeValue) ?? \"\"\n\n  if (isLoading) {\n    return (\n      <div\n        data-slot=\"codeblock-content\"\n        className={cn(\"p-4 text-sm text-[var(--muted-foreground)]\", className)}\n      >\n        <div className=\"animate-pulse\">Loading...</div>\n      </div>\n    )\n  }\n\n  return (\n    <div\n      data-slot=\"codeblock-content\"\n      className={cn(\n        \"overflow-x-auto text-sm p-4\",\n        showLines && \"codeblock-line-numbers\",\n        \"[&_pre]:!bg-transparent [&_pre]:!p-0 [&_code]:!bg-transparent\",\n        className\n      )}\n      dangerouslySetInnerHTML={{ __html: html }}\n      {...props}\n    />\n  )\n}\n\n/* -----------------------------------------------------------------------------\n * CodeBlockFooter\n * -------------------------------------------------------------------------- */\n\ninterface CodeBlockFooterProps extends React.ComponentProps<\"div\"> {}\n\nfunction CodeBlockFooter({ className, children, ...props }: CodeBlockFooterProps) {\n  return (\n    <div\n      data-slot=\"codeblock-footer\"\n      className={cn(\n        \"border-t px-4 py-2 text-sm text-[var(--muted-foreground)]\",\n        className\n      )}\n      {...props}\n    >\n      {children}\n    </div>\n  )\n}\n\n/* -----------------------------------------------------------------------------\n * Exports\n * -------------------------------------------------------------------------- */\n\nexport {\n  // Compound components\n  CodeBlock,\n  CodeBlockBody,\n  CodeBlockContent,\n  CodeBlockCopyButton,\n  CodeBlockFilename,\n  CodeBlockFiles,\n  CodeBlockFooter,\n  CodeBlockHeader,\n  CodeBlockItem,\n  CodeBlockSelect,\n  CodeBlockSelectContent,\n  CodeBlockSelectItem,\n  CodeBlockSelectTrigger,\n  CodeBlockSelectValue,\n  // Types\n  type CodeBlockData,\n  type CodeBlockTheme,\n}\n",
      "type": "registry:ui"
    }
  ],
  "type": "registry:ui"
}
