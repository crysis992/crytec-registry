{
  "$schema": "https://ui.shadcn.com/schema/registry-item.json",
  "name": "codeblock",
  "title": "CodeBlock",
  "description": "A compound code block component with syntax highlighting, multi-file tabs, copy button, and customizable themes.",
  "dependencies": [
    "shiki",
    "lucide-react"
  ],
  "registryDependencies": [
    "utils"
  ],
  "files": [
    {
      "path": "registry/new-york/ui/custom/codeblock.tsx",
      "content": "'use client';\r\n\r\nimport { Check, ChevronDown, Copy } from 'lucide-react';\r\nimport * as React from 'react';\r\nimport { type BundledLanguage, type BundledTheme, codeToHtml } from 'shiki';\r\n\r\nimport { cn } from '@/lib/utils';\r\n\r\n/* -----------------------------------------------------------------------------\r\n * Types\r\n * -------------------------------------------------------------------------- */\r\n\r\ninterface CodeBlockData {\r\n  value: string;\r\n  filename?: string;\r\n  code: string;\r\n  language?: string;\r\n}\r\n\r\ninterface CodeBlockTheme {\r\n  light: BundledTheme;\r\n  dark: BundledTheme;\r\n}\r\n\r\ninterface CodeBlockContextValue {\r\n  items: CodeBlockData[];\r\n  activeValue: string;\r\n  setActiveValue: (value: string) => void;\r\n  highlightedCode: Map<string, string>;\r\n  isLoading: boolean;\r\n  showLineNumbers: boolean;\r\n  theme: CodeBlockTheme;\r\n  copyCode: () => Promise<void>;\r\n  hasCopied: boolean;\r\n}\r\n\r\n/* -----------------------------------------------------------------------------\r\n * Context\r\n * -------------------------------------------------------------------------- */\r\n\r\nconst CodeBlockContext = React.createContext<CodeBlockContextValue | null>(null);\r\n\r\nfunction useCodeBlock() {\r\n  const context = React.useContext(CodeBlockContext);\r\n  if (!context) {\r\n    throw new Error('useCodeBlock must be used within a CodeBlock');\r\n  }\r\n  return context;\r\n}\r\n\r\n/* -----------------------------------------------------------------------------\r\n * CodeBlock (Root)\r\n * -------------------------------------------------------------------------- */\r\n\r\ninterface CodeBlockProps {\r\n  data: CodeBlockData[];\r\n  defaultValue?: string;\r\n  children: React.ReactNode;\r\n  className?: string;\r\n  showLineNumbers?: boolean;\r\n  theme?: CodeBlockTheme;\r\n}\r\n\r\nfunction CodeBlock({\r\n  data,\r\n  defaultValue,\r\n  children,\r\n  className,\r\n  showLineNumbers = false,\r\n  theme = { light: 'github-light', dark: 'github-dark' },\r\n}: CodeBlockProps) {\r\n  const [activeValue, setActiveValue] = React.useState(defaultValue ?? data[0]?.value ?? '');\r\n  const [highlightedCode, setHighlightedCode] = React.useState<Map<string, string>>(new Map());\r\n  const [isLoading, setIsLoading] = React.useState(true);\r\n  const [hasCopied, setHasCopied] = React.useState(false);\r\n\r\n  // Stable dependency key for data array to prevent infinite re-renders\r\n  const _dataKey = React.useMemo(() => JSON.stringify(data.map((d) => ({ v: d.value, c: d.code, l: d.language }))), [data]);\r\n  const _themeKey = `${theme.light}-${theme.dark}`;\r\n\r\n  React.useEffect(() => {\r\n    let cancelled = false;\r\n\r\n    async function highlightAll() {\r\n      setIsLoading(true);\r\n      const results = new Map<string, string>();\r\n\r\n      for (const item of data) {\r\n        if (cancelled) return;\r\n\r\n        try {\r\n          const html = await codeToHtml(item.code.trim(), {\r\n            lang: (item.language ?? item.value) as BundledLanguage,\r\n            themes: {\r\n              light: theme.light,\r\n              dark: theme.dark,\r\n            },\r\n          });\r\n          results.set(item.value, html);\r\n        } catch {\r\n          // Fallback to plaintext if language not supported\r\n          const html = await codeToHtml(item.code.trim(), {\r\n            lang: 'plaintext',\r\n            themes: {\r\n              light: theme.light,\r\n              dark: theme.dark,\r\n            },\r\n          });\r\n          results.set(item.value, html);\r\n        }\r\n      }\r\n\r\n      if (!cancelled) {\r\n        setHighlightedCode(results);\r\n        setIsLoading(false);\r\n      }\r\n    }\r\n\r\n    highlightAll();\r\n\r\n    return () => {\r\n      cancelled = true;\r\n    };\r\n    // eslint-disable-next-line react-hooks/exhaustive-deps\r\n  }, [data, theme.dark, theme.light]);\r\n\r\n  React.useEffect(() => {\r\n    if (hasCopied) {\r\n      const timeout = setTimeout(() => setHasCopied(false), 2000);\r\n      return () => clearTimeout(timeout);\r\n    }\r\n  }, [hasCopied]);\r\n\r\n  const copyCode = React.useCallback(async () => {\r\n    const activeItem = data.find((item) => item.value === activeValue);\r\n    if (activeItem) {\r\n      await navigator.clipboard.writeText(activeItem.code.trim());\r\n      setHasCopied(true);\r\n    }\r\n  }, [data, activeValue]);\r\n\r\n  const contextValue = React.useMemo(\r\n    () => ({\r\n      items: data,\r\n      activeValue,\r\n      setActiveValue,\r\n      highlightedCode,\r\n      isLoading,\r\n      showLineNumbers,\r\n      theme,\r\n      copyCode,\r\n      hasCopied,\r\n    }),\r\n    [data, activeValue, highlightedCode, isLoading, showLineNumbers, theme, copyCode, hasCopied],\r\n  );\r\n\r\n  return (\r\n    <CodeBlockContext.Provider value={contextValue}>\r\n      <div\r\n        data-slot=\"codeblock\"\r\n        className={cn('rounded-lg border bg-[var(--muted)] overflow-hidden', className)}\r\n      >\r\n        {children}\r\n      </div>\r\n    </CodeBlockContext.Provider>\r\n  );\r\n}\r\n\r\n/* -----------------------------------------------------------------------------\r\n * CodeBlockHeader\r\n * -------------------------------------------------------------------------- */\r\n\r\ninterface CodeBlockHeaderProps extends React.ComponentProps<'div'> {}\r\n\r\nfunction CodeBlockHeader({ className, children, ...props }: CodeBlockHeaderProps) {\r\n  return (\r\n    <div\r\n      data-slot=\"codeblock-header\"\r\n      className={cn('flex items-center justify-between border-b px-4 py-2', className)}\r\n      {...props}\r\n    >\r\n      {children}\r\n    </div>\r\n  );\r\n}\r\n\r\n/* -----------------------------------------------------------------------------\r\n * CodeBlockFiles\r\n * -------------------------------------------------------------------------- */\r\n\r\ninterface CodeBlockFilesProps {\r\n  children: (item: CodeBlockData) => React.ReactNode;\r\n  className?: string;\r\n}\r\n\r\nfunction CodeBlockFiles({ children, className }: CodeBlockFilesProps) {\r\n  const { items } = useCodeBlock();\r\n\r\n  return (\r\n    <div\r\n      data-slot=\"codeblock-files\"\r\n      className={cn('flex items-center gap-1', className)}\r\n    >\r\n      {items.map((item) => children(item))}\r\n    </div>\r\n  );\r\n}\r\n\r\n/* -----------------------------------------------------------------------------\r\n * CodeBlockFilename\r\n * -------------------------------------------------------------------------- */\r\n\r\ninterface CodeBlockFilenameProps extends React.ComponentProps<'button'> {\r\n  value: string;\r\n}\r\n\r\nfunction CodeBlockFilename({ value, children, className, ...props }: CodeBlockFilenameProps) {\r\n  const { activeValue, setActiveValue } = useCodeBlock();\r\n  const isActive = activeValue === value;\r\n\r\n  return (\r\n    <button\r\n      type=\"button\"\r\n      data-slot=\"codeblock-filename\"\r\n      data-active={isActive}\r\n      className={cn(\r\n        'px-3 py-1 text-sm font-mono rounded-md transition-colors',\r\n        isActive ? 'bg-[var(--background)] text-[var(--foreground)]' : 'text-[var(--muted-foreground)] hover:text-[var(--foreground)]',\r\n        className,\r\n      )}\r\n      onClick={() => setActiveValue(value)}\r\n      {...props}\r\n    >\r\n      {children}\r\n    </button>\r\n  );\r\n}\r\n\r\n/* -----------------------------------------------------------------------------\r\n * CodeBlockSelect\r\n * -------------------------------------------------------------------------- */\r\n\r\nconst CodeBlockSelectContext = React.createContext<{\r\n  open: boolean;\r\n  setOpen: React.Dispatch<React.SetStateAction<boolean>>;\r\n} | null>(null);\r\n\r\ninterface CodeBlockSelectProps {\r\n  children: React.ReactNode;\r\n}\r\n\r\nfunction CodeBlockSelect({ children }: CodeBlockSelectProps) {\r\n  const [open, setOpen] = React.useState(false);\r\n\r\n  return (\r\n    <CodeBlockSelectContext.Provider value={{ open, setOpen }}>\r\n      <div\r\n        data-slot=\"codeblock-select\"\r\n        className=\"relative\"\r\n      >\r\n        {children}\r\n      </div>\r\n    </CodeBlockSelectContext.Provider>\r\n  );\r\n}\r\n\r\n/* -----------------------------------------------------------------------------\r\n * CodeBlockSelectTrigger\r\n * -------------------------------------------------------------------------- */\r\n\r\ninterface CodeBlockSelectTriggerProps extends React.ComponentProps<'button'> {}\r\n\r\nfunction CodeBlockSelectTrigger({ className, children, ...props }: CodeBlockSelectTriggerProps) {\r\n  const selectContext = React.useContext(CodeBlockSelectContext);\r\n\r\n  return (\r\n    <button\r\n      type=\"button\"\r\n      data-slot=\"codeblock-select-trigger\"\r\n      className={cn(\r\n        'flex items-center gap-2 px-3 py-1 text-sm font-mono rounded-md border bg-[var(--background)] transition-colors hover:bg-[var(--accent)]',\r\n        className,\r\n      )}\r\n      onClick={() => selectContext?.setOpen((prev) => !prev)}\r\n      {...props}\r\n    >\r\n      {children}\r\n      <ChevronDown className=\"h-4 w-4\" />\r\n    </button>\r\n  );\r\n}\r\n\r\n/* -----------------------------------------------------------------------------\r\n * CodeBlockSelectValue\r\n * -------------------------------------------------------------------------- */\r\n\r\ninterface CodeBlockSelectValueProps {\r\n  placeholder?: string;\r\n}\r\n\r\nfunction CodeBlockSelectValue({ placeholder }: CodeBlockSelectValueProps) {\r\n  const { items, activeValue } = useCodeBlock();\r\n  const activeItem = items.find((item) => item.value === activeValue);\r\n\r\n  return <span data-slot=\"codeblock-select-value\">{activeItem?.filename ?? activeItem?.value ?? placeholder ?? 'Select...'}</span>;\r\n}\r\n\r\n/* -----------------------------------------------------------------------------\r\n * CodeBlockSelectContent\r\n * -------------------------------------------------------------------------- */\r\n\r\ninterface CodeBlockSelectContentProps {\r\n  children: (item: CodeBlockData) => React.ReactNode;\r\n}\r\n\r\nfunction CodeBlockSelectContent({ children }: CodeBlockSelectContentProps) {\r\n  const selectContext = React.useContext(CodeBlockSelectContext);\r\n  const { items } = useCodeBlock();\r\n\r\n  if (!selectContext?.open) return null;\r\n\r\n  return (\r\n    <div\r\n      data-slot=\"codeblock-select-content\"\r\n      className=\"absolute top-full left-0 mt-1 min-w-[150px] rounded-md border bg-[var(--background)] shadow-md z-50\"\r\n    >\r\n      {items.map((item) => children(item))}\r\n    </div>\r\n  );\r\n}\r\n\r\n/* -----------------------------------------------------------------------------\r\n * CodeBlockSelectItem\r\n * -------------------------------------------------------------------------- */\r\n\r\ninterface CodeBlockSelectItemProps extends React.ComponentProps<'button'> {\r\n  value: string;\r\n}\r\n\r\nfunction CodeBlockSelectItem({ value, children, className, ...props }: CodeBlockSelectItemProps) {\r\n  const { activeValue, setActiveValue } = useCodeBlock();\r\n  const selectContext = React.useContext(CodeBlockSelectContext);\r\n  const isActive = activeValue === value;\r\n\r\n  return (\r\n    <button\r\n      type=\"button\"\r\n      data-slot=\"codeblock-select-item\"\r\n      data-active={isActive}\r\n      className={cn(\r\n        'w-full px-3 py-2 text-sm text-left transition-colors hover:bg-[var(--accent)]',\r\n        isActive && 'bg-[var(--accent)]',\r\n        className,\r\n      )}\r\n      onClick={() => {\r\n        setActiveValue(value);\r\n        selectContext?.setOpen(false);\r\n      }}\r\n      {...props}\r\n    >\r\n      {children}\r\n    </button>\r\n  );\r\n}\r\n\r\n/* -----------------------------------------------------------------------------\r\n * CodeBlockCopyButton\r\n * -------------------------------------------------------------------------- */\r\n\r\ninterface CodeBlockCopyButtonProps extends React.ComponentProps<'button'> {\r\n  onCopy?: () => void;\r\n  onError?: (error: unknown) => void;\r\n}\r\n\r\nfunction CodeBlockCopyButton({ onCopy, onError, className, ...props }: CodeBlockCopyButtonProps) {\r\n  const { copyCode, hasCopied } = useCodeBlock();\r\n\r\n  const handleCopy = async () => {\r\n    try {\r\n      await copyCode();\r\n      onCopy?.();\r\n    } catch (error) {\r\n      onError?.(error);\r\n    }\r\n  };\r\n\r\n  return (\r\n    <button\r\n      type=\"button\"\r\n      data-slot=\"codeblock-copy\"\r\n      className={cn(\r\n        'h-8 w-8 inline-flex items-center justify-center rounded-md border bg-[var(--background)] transition-all hover:bg-[var(--accent)] focus:outline-none',\r\n        className,\r\n      )}\r\n      onClick={handleCopy}\r\n      aria-label=\"Copy code\"\r\n      {...props}\r\n    >\r\n      {hasCopied ? <Check className=\"h-4 w-4 text-green-500\" /> : <Copy className=\"h-4 w-4\" />}\r\n    </button>\r\n  );\r\n}\r\n\r\n/* -----------------------------------------------------------------------------\r\n * CodeBlockBody\r\n * -------------------------------------------------------------------------- */\r\n\r\ninterface CodeBlockBodyProps {\r\n  children: (item: CodeBlockData) => React.ReactNode;\r\n  className?: string;\r\n}\r\n\r\nfunction CodeBlockBody({ children, className }: CodeBlockBodyProps) {\r\n  const { items } = useCodeBlock();\r\n\r\n  return (\r\n    <div\r\n      data-slot=\"codeblock-body\"\r\n      className={className}\r\n    >\r\n      {items.map((item) => children(item))}\r\n    </div>\r\n  );\r\n}\r\n\r\n/* -----------------------------------------------------------------------------\r\n * CodeBlockItem\r\n * -------------------------------------------------------------------------- */\r\n\r\ninterface CodeBlockItemProps extends React.ComponentProps<'div'> {\r\n  value: string;\r\n}\r\n\r\nfunction CodeBlockItem({ value, children, className, ...props }: CodeBlockItemProps) {\r\n  const { activeValue } = useCodeBlock();\r\n\r\n  if (activeValue !== value) return null;\r\n\r\n  return (\r\n    <div\r\n      data-slot=\"codeblock-item\"\r\n      className={cn('relative', className)}\r\n      {...props}\r\n    >\r\n      {children}\r\n    </div>\r\n  );\r\n}\r\n\r\n/* -----------------------------------------------------------------------------\r\n * CodeBlockContent\r\n * -------------------------------------------------------------------------- */\r\n\r\ninterface CodeBlockContentProps extends React.ComponentProps<'div'> {\r\n  showLineNumbers?: boolean;\r\n}\r\n\r\nfunction CodeBlockContent({ showLineNumbers: propShowLineNumbers, className, ...props }: CodeBlockContentProps) {\r\n  const { highlightedCode, isLoading, showLineNumbers: contextShowLineNumbers, activeValue } = useCodeBlock();\r\n\r\n  const showLines = propShowLineNumbers ?? contextShowLineNumbers;\r\n  const html = highlightedCode.get(activeValue) ?? '';\r\n\r\n  if (isLoading) {\r\n    return (\r\n      <div\r\n        data-slot=\"codeblock-content\"\r\n        className={cn('p-4 text-sm text-[var(--muted-foreground)]', className)}\r\n      >\r\n        <div className=\"animate-pulse\">Loading...</div>\r\n      </div>\r\n    );\r\n  }\r\n\r\n  return (\r\n    <div\r\n      data-slot=\"codeblock-content\"\r\n      className={cn(\r\n        'overflow-x-auto text-sm p-4',\r\n        showLines && 'codeblock-line-numbers',\r\n        '[&_pre]:!bg-transparent [&_pre]:!p-0 [&_code]:!bg-transparent',\r\n        className,\r\n      )}\r\n      dangerouslySetInnerHTML={{ __html: html }}\r\n      {...props}\r\n    />\r\n  );\r\n}\r\n\r\n/* -----------------------------------------------------------------------------\r\n * CodeBlockFooter\r\n * -------------------------------------------------------------------------- */\r\n\r\ninterface CodeBlockFooterProps extends React.ComponentProps<'div'> {}\r\n\r\nfunction CodeBlockFooter({ className, children, ...props }: CodeBlockFooterProps) {\r\n  return (\r\n    <div\r\n      data-slot=\"codeblock-footer\"\r\n      className={cn('border-t px-4 py-2 text-sm text-[var(--muted-foreground)]', className)}\r\n      {...props}\r\n    >\r\n      {children}\r\n    </div>\r\n  );\r\n}\r\n\r\n/* -----------------------------------------------------------------------------\r\n * Exports\r\n * -------------------------------------------------------------------------- */\r\n\r\nexport {\r\n  // Compound components\r\n  CodeBlock,\r\n  CodeBlockBody,\r\n  CodeBlockContent,\r\n  CodeBlockCopyButton,\r\n  CodeBlockFilename,\r\n  CodeBlockFiles,\r\n  CodeBlockFooter,\r\n  CodeBlockHeader,\r\n  CodeBlockItem,\r\n  CodeBlockSelect,\r\n  CodeBlockSelectContent,\r\n  CodeBlockSelectItem,\r\n  CodeBlockSelectTrigger,\r\n  CodeBlockSelectValue,\r\n  // Types\r\n  type CodeBlockData,\r\n  type CodeBlockTheme,\r\n};\r\n",
      "type": "registry:ui"
    }
  ],
  "type": "registry:ui"
}